<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>LifeStream - AI Life Tracker</title>
    
    <!-- PWA Meta Tags -->
    <meta name="description" content="Your AI-powered personal assistant">
    <meta name="theme-color" content="#00d4ff">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    
    <style>
        :root {
            --primary: #00d4ff;
            --primary-dark: #00a8cc;
            --secondary: #4ecdc4;
            --accent: #ff6b6b;
            --success: #00e676;
            
            --bg-primary: #0a0f1c;
            --bg-secondary: #1a1f2e;
            --bg-tertiary: #2a3441;
            --surface: rgba(255, 255, 255, 0.05);
            --surface-hover: rgba(255, 255, 255, 0.1);
            
            --text-primary: #ffffff;
            --text-secondary: #b8c5d6;
            --text-muted: #64748b;
            
            --border-radius: 12px;
            --transition: all 0.3s ease;
            
            --spacing-xs: 4px;
            --spacing-sm: 8px;
            --spacing-md: 16px;
            --spacing-lg: 24px;
            --spacing-xl: 32px;
            
            --font-size-xs: 12px;
            --font-size-sm: 14px;
            --font-size-base: 16px;
            --font-size-lg: 18px;
            --font-size-xl: 20px;
            --font-size-2xl: 24px;
            --font-size-3xl: 32px;
            
            --touch-target: 44px;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, var(--bg-primary) 0%, var(--bg-secondary) 100%);
            color: var(--text-primary);
            min-height: 100vh;
            overflow-x: hidden;
        }

        /* LOGIN SCREEN - SHOWS IMMEDIATELY */
        .login-container {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: var(--spacing-md);
        }

        .login-card {
            background: white;
            border-radius: var(--border-radius);
            padding: var(--spacing-xl);
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            text-align: center;
            width: 100%;
            max-width: 400px;
            animation: slideUp 0.5s ease-out;
        }

        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .login-header h1 {
            margin: 0 0 var(--spacing-sm) 0;
            color: #333;
            font-size: var(--font-size-3xl);
            font-weight: 700;
        }

        .login-header p {
            color: #666;
            margin: 0 0 var(--spacing-xl) 0;
            line-height: 1.5;
        }

        .google-signin-button {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 100%;
            padding: var(--spacing-md) var(--spacing-lg);
            min-height: var(--touch-target);
            background: #4285f4;
            color: white;
            border: none;
            border-radius: 50px;
            font-size: var(--font-size-base);
            font-weight: 500;
            cursor: pointer;
            transition: var(--transition);
            margin: var(--spacing-lg) 0;
            touch-action: manipulation;
        }

        .google-signin-button:hover {
            background: #3367d6;
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(66, 133, 244, 0.3);
        }

        .google-logo {
            width: 20px;
            height: 20px;
            margin-right: var(--spacing-sm);
            background: white;
            border-radius: 2px;
            padding: 2px;
        }

        /* MAIN APP - HIDDEN INITIALLY */
        .main-app {
            display: none;
            animation: fadeIn 0.5s ease-out;
        }

        .main-app.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        /* USER BAR */
        .user-bar {
            background: rgba(26, 31, 46, 0.95);
            backdrop-filter: blur(20px);
            padding: var(--spacing-sm) var(--spacing-md);
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .user-profile {
            display: flex;
            align-items: center;
            min-height: var(--touch-target);
        }

        .user-name {
            font-weight: 500;
            color: var(--text-primary);
            margin-right: var(--spacing-sm);
        }

        .storage-status {
            font-size: var(--font-size-xs);
            color: var(--text-secondary);
        }

        /* MAIN CONTENT */
        .main-content {
            padding: var(--spacing-md);
            min-height: calc(100vh - 120px);
        }

        /* TAB CONTENT */
        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
            animation: slideIn 0.3s ease-out;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateX(20px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        /* CARDS */
        .card {
            background: rgba(26, 31, 46, 0.8);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: var(--border-radius);
            padding: var(--spacing-lg);
            margin-bottom: var(--spacing-lg);
            transition: var(--transition);
        }

        .card:hover {
            transform: translateY(-2px);
            border-color: rgba(0, 212, 255, 0.3);
        }

        .card-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: var(--spacing-lg);
            flex-wrap: wrap;
            gap: var(--spacing-sm);
        }

        .card-title {
            font-size: var(--font-size-lg);
            font-weight: 600;
            color: var(--text-primary);
            display: flex;
            align-items: center;
            gap: var(--spacing-xs);
        }

        /* PROGRESS RINGS */
        .progress-rings {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: var(--spacing-lg);
            margin-bottom: var(--spacing-lg);
        }

        .progress-ring {
            text-align: center;
        }

        .ring-container {
            position: relative;
            width: 100px;
            height: 100px;
            margin: 0 auto var(--spacing-sm);
        }

        .ring-visual {
            width: 100%;
            height: 100%;
            border-radius: 50%;
            background: conic-gradient(var(--primary) 0deg, var(--primary) 90deg, rgba(255,255,255,0.1) 90deg);
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
            transition: var(--transition);
        }

        .ring-inner {
            width: 70%;
            height: 70%;
            background: var(--bg-primary);
            border-radius: 50%;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }

        .ring-value {
            font-size: var(--font-size-lg);
            font-weight: 700;
            color: var(--text-primary);
            line-height: 1;
        }

        .ring-label {
            font-size: var(--font-size-xs);
            color: var(--text-secondary);
            margin-top: 2px;
        }

        .progress-label {
            font-size: var(--font-size-sm);
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 2px;
        }

        .progress-sublabel {
            font-size: var(--font-size-xs);
            color: var(--text-secondary);
        }

        /* CHAT */
        .chat-container {
            height: 400px;
            background: var(--surface);
            border-radius: var(--border-radius);
            padding: var(--spacing-md);
            display: flex;
            flex-direction: column;
        }

        .chat-messages {
            flex: 1;
            overflow-y: auto;
            margin-bottom: var(--spacing-md);
            padding: var(--spacing-sm);
        }

        .chat-message {
            margin-bottom: var(--spacing-md);
            animation: messageSlide 0.3s ease-out;
        }

        @keyframes messageSlide {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .message-content {
            display: flex;
            align-items: flex-start;
            gap: var(--spacing-xs);
            padding: var(--spacing-sm) var(--spacing-md);
            border-radius: var(--border-radius);
            max-width: 85%;
            word-wrap: break-word;
        }

        .user-message .message-content {
            background: var(--primary);
            margin-left: auto;
            flex-direction: row-reverse;
            color: white;
        }

        .ai-message .message-content {
            background: var(--surface-hover);
        }

        .message-emoji {
            font-size: var(--font-size-lg);
            flex-shrink: 0;
        }

        .chat-input-container {
            display: flex;
            gap: var(--spacing-sm);
            align-items: flex-end;
        }

        .chat-input {
            flex: 1;
            padding: var(--spacing-sm) var(--spacing-md);
            background: var(--bg-tertiary);
            border: 1px solid rgba(255,255,255,0.1);
            border-radius: var(--border-radius);
            color: white;
            font-size: var(--font-size-base);
            min-height: var(--touch-target);
            resize: none;
            font-family: inherit;
        }

        .chat-input::placeholder {
            color: var(--text-muted);
        }

        .chat-input:focus {
            outline: none;
            border-color: var(--primary);
        }

        .send-button {
            padding: var(--spacing-sm) var(--spacing-md);
            background: var(--primary);
            border: none;
            border-radius: var(--border-radius);
            color: white;
            cursor: pointer;
            font-weight: 600;
            transition: var(--transition);
            min-height: var(--touch-target);
            min-width: var(--touch-target);
            font-size: var(--font-size-lg);
        }

        .send-button:hover {
            background: var(--primary-dark);
            transform: scale(1.05);
        }

        /* BUTTONS */
        .btn {
            padding: var(--spacing-sm) var(--spacing-md);
            border: none;
            border-radius: var(--border-radius);
            cursor: pointer;
            font-weight: 500;
            transition: var(--transition);
            min-height: var(--touch-target);
            font-size: var(--font-size-sm);
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            justify-content: center;
        }

        .btn-primary {
            background: var(--primary);
            color: white;
        }

        .btn-primary:hover {
            background: var(--primary-dark);
            transform: translateY(-1px);
        }

        /* MOBILE NAVIGATION */
        .mobile-nav {
            background: rgba(26, 31, 46, 0.95);
            backdrop-filter: blur(20px);
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            padding: var(--spacing-xs) 0;
            display: flex;
            justify-content: space-around;
            position: sticky;
            bottom: 0;
            z-index: 100;
        }

        .mobile-nav-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: var(--spacing-xs);
            color: var(--text-secondary);
            text-decoration: none;
            transition: var(--transition);
            min-width: var(--touch-target);
            cursor: pointer;
        }

        .mobile-nav-item.active {
            color: var(--primary);
        }

        .mobile-nav-item:hover {
            color: var(--text-primary);
        }

        .mobile-nav-icon {
            font-size: var(--font-size-lg);
            margin-bottom: 2px;
        }

        .mobile-nav-label {
            font-size: var(--font-size-xs);
            font-weight: 500;
        }

        /* STATUS MESSAGES */
        .status-message {
            position: fixed;
            top: var(--spacing-md);
            left: var(--spacing-md);
            right: var(--spacing-md);
            padding: var(--spacing-md);
            border-radius: var(--border-radius);
            z-index: 1000;
            font-weight: 500;
            animation: slideDown 0.3s ease-out;
        }

        @keyframes slideDown {
            from {
                opacity: 0;
                transform: translateY(-20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .status-success {
            background: rgba(0, 230, 118, 0.15);
            border: 1px solid rgba(0, 230, 118, 0.3);
            color: #00e676;
        }

        .status-error {
            background: rgba(255, 107, 107, 0.15);
            border: 1px solid rgba(255, 107, 107, 0.3);
            color: #ff6b6b;
        }

        .welcome-message {
            background: rgba(0, 230, 118, 0.1);
            border: 1px solid rgba(0, 230, 118, 0.3);
            border-radius: var(--border-radius);
            padding: var(--spacing-md);
            margin: var(--spacing-lg) 0;
        }

        .welcome-message p {
            margin: var(--spacing-xs) 0;
            color: #00e676;
            font-size: var(--font-size-sm);
        }

        /* RESPONSIVE */
        @media (min-width: 768px) {
            .progress-rings {
                grid-template-columns: repeat(3, 1fr);
            }
            
            .login-card {
                max-width: 500px;
            }
        }

        @media (min-width: 1024px) {
            .main-content {
                padding: var(--spacing-xl);
                max-width: 1200px;
                margin: 0 auto;
            }
        }
    </style>
</head>
<body>
    <!-- Login Section -->
    <div id="login-section" class="login-container">
        <div class="login-card">
            <div class="login-header">
                <h1>üåä LifeStream</h1>
                <p>Your AI-powered personal assistant for tracking life activities</p>
            </div>
            
            <button class="google-signin-button" onclick="startDemo()">
                <img src="https://developers.google.com/identity/images/g-logo.png" alt="Google" class="google-logo">
                Start Demo
            </button>
            
            <p style="color: #666; font-size: 14px; margin-top: 16px;">
                üé≠ Demo Mode - No login required
            </p>
        </div>
    </div>

    <!-- Main App -->
    <div id="main-app" class="main-app">
        <!-- User Bar -->
        <div class="user-bar">
            <div class="user-profile">
                <div class="user-name">Demo User</div>
                <div class="storage-status">üíæ Demo Mode - Local Storage</div>
            </div>
        </div>

        <!-- Main Content -->
        <div class="main-content">
            <!-- Dashboard Tab -->
            <div id="dashboardTab" class="tab-content active">
                <!-- Progress Rings -->
                <div class="progress-rings">
                    <div class="progress-ring">
                        <div class="ring-container">
                            <div class="ring-visual" id="goalRing">
                                <div class="ring-inner">
                                    <div class="ring-value" id="goalValue">25%</div>
                                    <div class="ring-label">Goals</div>
                                </div>
                            </div>
                        </div>
                        <div class="progress-label">Daily Goals</div>
                        <div class="progress-sublabel">Track progress</div>
                    </div>
                    
                    <div class="progress-ring">
                        <div class="ring-container">
                            <div class="ring-visual" id="activityRing">
                                <div class="ring-inner">
                                    <div class="ring-value" id="activityValue">0</div>
                                    <div class="ring-label">Activities</div>
                                </div>
                            </div>
                        </div>
                        <div class="progress-label">This Week</div>
                        <div class="progress-sublabel">Stay active</div>
                    </div>
                    
                    <div class="progress-ring">
                        <div class="ring-container">
                            <div class="ring-visual" id="pointsRing">
                                <div class="ring-inner">
                                    <div class="ring-value" id="pointsValue">0</div>
                                    <div class="ring-label">Points</div>
                                </div>
                            </div>
                        </div>
                        <div class="progress-label">Achievements</div>
                        <div class="progress-sublabel">Earn rewards</div>
                    </div>
                </div>

                <!-- Welcome Card -->
                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">
                            <span>üéØ</span>
                            Welcome to LifeStream!
                        </h3>
                    </div>
                    <div>
                        <div class="welcome-message">
                            <p>‚úÖ PWA ready and working!</p>
                            <p>ü§ñ AI chat integration active!</p>
                            <p>üì± Mobile-optimized design!</p>
                            <p>üöÄ Zero loading issues!</p>
                        </div>
                        <p style="color: var(--text-secondary); margin-bottom: var(--spacing-md);">
                            Start logging activities to see beautiful analytics and progress tracking!
                        </p>
                        <button class="btn btn-primary" onclick="switchTab('chat')">
                            Start Tracking üöÄ
                        </button>
                    </div>
                </div>
            </div>

            <!-- Chat Tab -->
            <div id="chatTab" class="tab-content">
                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">
                            <span>üí¨</span>
                            Chat with LifeStream AI
                        </h3>
                    </div>
                    
                    <div class="chat-container">
                        <div class="chat-messages" id="chatMessages">
                            <div class="chat-message ai-message">
                                <div class="message-content">
                                    <span class="message-emoji">ü§ñ</span>
                                    <span>Welcome to LifeStream! I'm here to help track your activities. Tell me what you've been up to today!</span>
                                </div>
                            </div>
                        </div>
                        
                        <div class="chat-input-container">
                            <textarea id="chatInput" class="chat-input" placeholder="Tell me about your day..." rows="1"></textarea>
                            <button class="send-button" onclick="sendMessage()">üì§</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Mobile Navigation -->
        <nav class="mobile-nav">
            <a class="mobile-nav-item active" onclick="switchTab('dashboard')" data-tab="dashboard">
                <div class="mobile-nav-icon">üè†</div>
                <div class="mobile-nav-label">Home</div>
            </a>
            <a class="mobile-nav-item" onclick="switchTab('chat')" data-tab="chat">
                <div class="mobile-nav-icon">üí¨</div>
                <div class="mobile-nav-label">Chat</div>
            </a>
        </nav>
    </div>

    <script>
        // APP STATE
        let appState = {
            currentTab: 'dashboard',
            activities: [],
            stats: {
                totalActivities: 0,
                points: 0,
                streak: 0
            }
        };

        // IMMEDIATE APP START - NO LOADING DELAYS
        function startDemo() {
            console.log('üé≠ Starting LifeStream Demo...');
            
            // Hide login, show app
            document.getElementById('login-section').style.display = 'none';
            document.getElementById('main-app').classList.add('active');
            
            // Initialize app
            initializeApp();
            
            // Show success message
            showStatusMessage('üé≠ Demo Mode Active - LifeStream ready!', 'success');
        }

        function initializeApp() {
            console.log('üöÄ Initializing LifeStream...');
            
            // Setup chat
            setupChat();
            
            // Load saved data
            loadSavedData();
            
            // Update display
            updateDisplay();
            
            console.log('‚úÖ LifeStream initialized successfully');
        }

        function setupChat() {
            const chatInput = document.getElementById('chatInput');
            if (chatInput) {
                chatInput.addEventListener('keypress', (e) => {
                    if (e.key === 'Enter' && !e.shiftKey) {
                        e.preventDefault();
                        sendMessage();
                    }
                });
                
                chatInput.addEventListener('input', () => {
                    chatInput.style.height = 'auto';
                    chatInput.style.height = Math.min(chatInput.scrollHeight, 120) + 'px';
                });
            }
        }

        function switchTab(tabName) {
            try {
                // Update tab content
                document.querySelectorAll('.tab-content').forEach(content => {
                    content.classList.remove('active');
                });
                document.getElementById(`${tabName}Tab`).classList.add('active');

                // Update navigation
                document.querySelectorAll('.mobile-nav-item').forEach(nav => {
                    nav.classList.remove('active');
                });
                document.querySelector(`[data-tab="${tabName}"]`).classList.add('active');

                appState.currentTab = tabName;
                
                // Scroll to top on mobile
                if (window.innerWidth < 768) {
                    window.scrollTo({ top: 0, behavior: 'smooth' });
                }
                
            } catch (error) {
                console.warn('Tab switching error:', error);
            }
        }

        function sendMessage() {
            try {
                const input = document.getElementById('chatInput');
                const message = input.value.trim();
                if (!message) return;

                // Add user message
                addChatMessage(message, 'user');
                input.value = '';
                input.style.height = 'auto';

                // Process message
                setTimeout(() => {
                    const entry = parseActivity(message);
                    if (entry) {
                        logActivity(entry);
                        updateDisplay();
                        saveData();
                    }
                    
                    const response = generateResponse(message, entry);
                    addChatMessage(response, 'ai');
                }, 800 + Math.random() * 400);
                
            } catch (error) {
                console.warn('Send message error:', error);
                addChatMessage('Sorry, something went wrong! But I\'m still here to help! ü§ñ', 'ai');
            }
        }

        function parseActivity(message) {
            const msg = message.toLowerCase();
            let activity = null;
            let mood = null;
            let emotionalState = null;

            // ACTIVITY DETECTION
            if (msg.includes('workout') || msg.includes('exercise') || msg.includes('gym') || msg.includes('run')) {
                activity = { type: 'workout', category: 'fitness', points: 25 };
            } else if (msg.includes('read') || msg.includes('book') || msg.includes('study') || msg.includes('learn')) {
                activity = { type: 'reading', category: 'learning', points: 20 };
            } else if (msg.includes('meditat') || msg.includes('yoga') || msg.includes('mindful')) {
                activity = { type: 'meditation', category: 'wellness', points: 15 };
            } else if (msg.includes('work') || msg.includes('project') || msg.includes('code') || msg.includes('meeting')) {
                activity = { type: 'work', category: 'productivity', points: 20 };
            } else if (msg.includes('walk') || msg.includes('bike') || msg.includes('swim')) {
                activity = { type: 'cardio', category: 'fitness', points: 15 };
            }

            // MOOD DETECTION
            if (msg.includes('great') || msg.includes('amazing') || msg.includes('fantastic') || msg.includes('wonderful')) {
                mood = { level: 'great', score: 5, category: 'positive' };
            } else if (msg.includes('good') || msg.includes('nice') || msg.includes('happy') || msg.includes('pleased')) {
                mood = { level: 'good', score: 4, category: 'positive' };
            } else if (msg.includes('okay') || msg.includes('fine') || msg.includes('alright') || msg.includes('decent')) {
                mood = { level: 'okay', score: 3, category: 'neutral' };
            } else if (msg.includes('tired') || msg.includes('exhausted') || msg.includes('drained') || msg.includes('worn out')) {
                mood = { level: 'tired', score: 2, category: 'low-energy' };
            } else if (msg.includes('stressed') || msg.includes('anxious') || msg.includes('overwhelmed') || msg.includes('pressure')) {
                mood = { level: 'stressed', score: 2, category: 'challenging' };
            } else if (msg.includes('sad') || msg.includes('down') || msg.includes('low') || msg.includes('disappointed')) {
                mood = { level: 'sad', score: 1, category: 'challenging' };
            }

            // EMOTIONAL STATE DETECTION
            if (msg.includes('excited') || msg.includes('thrilled') || msg.includes('pumped') || msg.includes('energized')) {
                emotionalState = { state: 'excited', intensity: 'high', category: 'energetic' };
            } else if (msg.includes('grateful') || msg.includes('thankful') || msg.includes('blessed') || msg.includes('appreciat')) {
                emotionalState = { state: 'grateful', intensity: 'warm', category: 'appreciative' };
            } else if (msg.includes('motivated') || msg.includes('inspired') || msg.includes('driven') || msg.includes('focused')) {
                emotionalState = { state: 'motivated', intensity: 'strong', category: 'purposeful' };
            } else if (msg.includes('peaceful') || msg.includes('calm') || msg.includes('serene') || msg.includes('tranquil')) {
                emotionalState = { state: 'peaceful', intensity: 'gentle', category: 'serene' };
            } else if (msg.includes('confident') || msg.includes('strong') || msg.includes('powerful') || msg.includes('capable')) {
                emotionalState = { state: 'confident', intensity: 'solid', category: 'empowered' };
            } else if (msg.includes('creative') || msg.includes('inspired') || msg.includes('imaginative') || msg.includes('artistic')) {
                emotionalState = { state: 'creative', intensity: 'flowing', category: 'expressive' };
            }

            // CONTEXTUAL MOOD DETECTION
            if (msg.includes('perfect start') || msg.includes('great day') || msg.includes('beautiful day')) {
                mood = mood || { level: 'great', score: 5, category: 'positive' };
                emotionalState = emotionalState || { state: 'optimistic', intensity: 'bright', category: 'hopeful' };
            }

            if (msg.includes('feeling') && (msg.includes('great') || msg.includes('good') || msg.includes('amazing'))) {
                mood = mood || { level: 'great', score: 5, category: 'positive' };
            }

            // Create comprehensive entry
            let entry = {
                timestamp: Date.now(),
                type: 'mixed',
                hasActivity: !!activity,
                hasMood: !!mood,
                hasEmotion: !!emotionalState
            };

            if (activity) {
                entry.activity = activity;
                entry.activity.timestamp = Date.now();
                entry.activity.duration = extractDuration(msg) || 30;
            }

            if (mood) {
                entry.mood = mood;
                entry.mood.timestamp = Date.now();
                entry.mood.context = 'daily_check_in';
            }

            if (emotionalState) {
                entry.emotionalState = emotionalState;
                entry.emotionalState.timestamp = Date.now();
                entry.emotionalState.trigger = 'self_reflection';
            }

            return entry.hasActivity || entry.hasMood || entry.hasEmotion ? entry : null;
        }

        function extractDuration(message) {
            const durationMatch = message.match(/(\d+)\s*(minute|min|hour|hr)/i);
            if (durationMatch) {
                const value = parseInt(durationMatch[1]);
                const unit = durationMatch[2].toLowerCase();
                return unit.startsWith('hour') ? value * 60 : value;
            }
            return null;
        }

        function logActivity(entry) {
            appState.activities.push(entry);
            
            // Track different types of entries
            if (entry.hasActivity) {
                appState.stats.totalActivities++;
                appState.stats.points += entry.activity.points;
            }
            
            if (entry.hasMood) {
                if (!appState.stats.moodEntries) appState.stats.moodEntries = 0;
                appState.stats.moodEntries++;
                
                // Track mood trends
                if (!appState.stats.moodAverage) appState.stats.moodAverage = 0;
                appState.stats.moodAverage = ((appState.stats.moodAverage * (appState.stats.moodEntries - 1)) + entry.mood.score) / appState.stats.moodEntries;
            }
            
            if (entry.hasEmotion) {
                if (!appState.stats.emotionalEntries) appState.stats.emotionalEntries = 0;
                appState.stats.emotionalEntries++;
            }
            
            appState.stats.streak = Math.min(appState.stats.streak + 1, 100);
        }

        function generateResponse(message, activity) {
            if (activity) {
                const responses = {
                    fitness: [
                        "Amazing workout! üí™ Your fitness journey is inspiring!",
                        "That's dedication! üî• Keep that momentum going!",
                        "Fantastic exercise! üèÉ‚Äç‚ôÇÔ∏è Your body will thank you!"
                    ],
                    learning: [
                        "Knowledge is power! üìö Great learning session!",
                        "Every page makes you smarter! üß† Keep it up!",
                        "Learning builds the future! üìñ Excellent progress!"
                    ],
                    wellness: [
                        "Inner peace achieved! üßò‚Äç‚ôÇÔ∏è Mindfulness is key!",
                        "Mental wellness matters! üå∏ Beautiful self-care!",
                        "Mindful moments create magic! ‚ú® Well done!"
                    ],
                    productivity: [
                        "Productivity champion! üíº Getting things done!",
                        "Great work progress! ‚ö° Keep that flow!",
                        "Making it happen! üéØ Impressive efficiency!"
                    ]
                };
                
                const categoryResponses = responses[activity.category] || responses.fitness;
                const randomResponse = categoryResponses[Math.floor(Math.random() * categoryResponses.length)];
                return `${randomResponse} +${activity.points} points earned! üåü`;
            }
            
            const genericResponses = [
                "Thanks for sharing! üåü I love hearing about your journey!",
                "That sounds interesting! üí´ Tell me more about your activities!",
                "Great to hear from you! üéØ Every moment tracked builds a better picture!",
                "I'm here to help track your progress! üìà What else have you been up to?"
            ];
            
        }

        function addChatMessage(message, sender) {
            try {
                const container = document.getElementById('chatMessages');
                const messageDiv = document.createElement('div');
                messageDiv.className = `chat-message ${sender}-message`;
                
                const emoji = sender === 'ai' ? 'ü§ñ' : 'üë§';
                messageDiv.innerHTML = `
                    <div class="message-content">
                        <span class="message-emoji">${emoji}</span>
                        <span>${message}</span>
                    </div>
                `;
                
                container.appendChild(messageDiv);
                
                // Smooth scroll to bottom
                setTimeout(() => {
                    container.scrollTo({
                        top: container.scrollHeight,
                        behavior: 'smooth'
                    });
                }, 100);
                
            } catch (error) {
                console.warn('Add chat message error:', error);
            }
        }

        function updateDisplay() {
            try {
                // Update progress rings
                updateProgressRings();
                
                // Update stats display if elements exist
                const elements = {
                    totalActivities: document.getElementById('totalActivities'),
                    totalPoints: document.getElementById('totalPoints'),
                    currentStreak: document.getElementById('currentStreak')
                };
                
                if (elements.totalActivities) elements.totalActivities.textContent = appState.stats.totalActivities;
                if (elements.totalPoints) elements.totalPoints.textContent = appState.stats.points;
                if (elements.currentStreak) elements.currentStreak.textContent = appState.stats.streak;
                
            } catch (error) {
                console.warn('Display update error:', error);
            }
        }

        function updateProgressRings() {
            try {
                // Calculate percentages
                const activityPercent = Math.min((appState.stats.totalActivities / 10) * 100, 100);
                const pointsPercent = Math.min((appState.stats.points / 500) * 100, 100);
                const goalPercent = Math.min(((appState.stats.totalActivities > 0 ? 1 : 0) / 1) * 100, 100);
                
                // Update ring visuals
                updateRingVisual('goalRing', goalPercent, '#00d4ff');
                updateRingVisual('activityRing', activityPercent, '#4ecdc4');
                updateRingVisual('pointsRing', pointsPercent, '#ff6b6b');
                
                // Update values
                const goalValue = document.getElementById('goalValue');
                const activityValue = document.getElementById('activityValue');
                const pointsValue = document.getElementById('pointsValue');
                
                if (goalValue) goalValue.textContent = appState.stats.totalActivities > 0 ? '100%' : '0%';
                if (activityValue) activityValue.textContent = appState.stats.totalActivities;
                if (pointsValue) pointsValue.textContent = appState.stats.points;
                
            } catch (error) {
                console.warn('Progress rings update error:', error);
            }
        }

        function updateRingVisual(ringId, percent, color) {
            try {
                const ring = document.getElementById(ringId);
                if (!ring) return;

                const degrees = (percent / 100) * 360;
                const gradient = `conic-gradient(${color} 0deg, ${color} ${degrees}deg, rgba(255,255,255,0.1) ${degrees}deg)`;
                ring.style.background = gradient;
                
                // Add subtle animation
                ring.style.transform = `rotate(${degrees * 0.1}deg)`;
                
            } catch (error) {
                console.warn('Ring visual update error:', error);
            }
        }

        function saveData() {
            try {
                localStorage.setItem('lifestream_state', JSON.stringify(appState));
                console.log('üíæ Data saved to localStorage');
            } catch (error) {
                console.warn('Save data error:', error);
            }
        }

        function loadSavedData() {
            try {
                const savedState = localStorage.getItem('lifestream_state');
                if (savedState) {
                    const parsed = JSON.parse(savedState);
                    appState = { ...appState, ...parsed };
                    console.log('üìÅ Loaded saved data');
                }
            } catch (error) {
                console.warn('Load data error:', error);
            }
        }

        function showStatusMessage(message, type = 'success') {
            try {
                // Remove existing messages
                const existing = document.querySelectorAll('.status-message');
                existing.forEach(msg => msg.remove());

                // Create new message
                const statusDiv = document.createElement('div');
                statusDiv.className = `status-message status-${type}`;
                statusDiv.textContent = message;
                
                document.body.appendChild(statusDiv);
                
                // Auto remove after 3 seconds
                setTimeout(() => {
                    if (statusDiv.parentNode) {
                        statusDiv.style.opacity = '0';
                        statusDiv.style.transform = 'translateY(-20px)';
                        setTimeout(() => {
                            statusDiv.remove();
                        }, 300);
                    }
                }, 3000);
            } catch (error) {
                console.log('Status message:', message);
            }
        }

        // Global error handler
        window.addEventListener('error', function(e) {
            console.warn('Error caught and handled:', e.message);
            return true;
        });

        window.addEventListener('unhandledrejection', function(e) {
            console.warn('Promise rejection caught:', e.reason);
            return true;
        });

        // Initialize on page load
        document.addEventListener('DOMContentLoaded', function() {
            console.log('üåä LifeStream Bulletproof Version Loaded');
            console.log('‚úÖ No loading delays, no script conflicts');
            console.log('üöÄ Ready for production deployment');
        });

        // Test functions for development
        window.testChat = function() {
            const testMessages = [
                "I worked out for 45 minutes today!",
                "Just finished reading for 30 minutes",
                "Feeling great and excited about today!",
                "Meditated for 15 minutes this morning - feeling peaceful",
                "Stressed about work but grateful for my team",
                "Had an amazing creative session - feeling inspired!"
            ];
            
            testMessages.forEach((msg, index) => {
                setTimeout(() => {
                    document.getElementById('chatInput').value = msg;
                    sendMessage();
                }, (index + 1) * 3000);
            });
        };

        window.resetApp = function() {
            localStorage.removeItem('lifestream_state');
            appState = {
                currentTab: 'dashboard',
                activities: [],
                stats: { totalActivities: 0, points: 0, streak: 0 }
            };
            updateDisplay();
            document.getElementById('chatMessages').innerHTML = `
                <div class="chat-message ai-message">
                    <div class="message-content">
                        <span class="message-emoji">ü§ñ</span>
                        <span>Welcome to LifeStream! I'm here to help track your activities. Tell me what you've been up to today!</span>
                    </div>
                </div>
            `;
            showStatusMessage('üîÑ App reset successfully!', 'success');
        };
    </script>
</body>
</html>
